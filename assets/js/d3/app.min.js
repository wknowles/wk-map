!function(){function t(){}function n(t){return 360*Math.atan(Math.exp(-t*Math.PI/180))/Math.PI-90}d3.quadTiles=function(e,a){function r(t,e,s,f){var d=s-t,p=n(e),g=n(f),h=c*d;o=!0,u.polygonStart(),u.lineStart();for(var m=t;s+h/2>m&&o;m+=h)u.point(m,p);for(var v=p;(v+=h)<g&&o;)u.point(s,v);for(var m=s;m>t-h/2&&o;m-=h)u.point(m,g);for(var v=g;(v-=h)>p&&o;)u.point(t,v);if(o&&u.point(t,p),u.lineEnd(),u.polygonEnd(),360/l>=d)o||i.push({type:"Polygon",coordinates:[d3.range(t,s+h/2,h).map(function(t){return[t,e]}).concat([[s,.5*(e+f)]]).concat(d3.range(s,t-h/2,-h).map(function(t){return[t,f]})).concat([[t,.5*(e+f)]]).concat([[t,e]]).map(function(t){return[t[0],n(t[1])]})],key:[0|(180+t)/360*l,0|(180+e)/360*l,a],centroid:[.5*(t+s),.5*(p+g)]});else if(!o){var m=.5*(t+s),v=.5*(e+f);r(t,e,m,v),r(m,e,s,v),r(t,v,m,f),r(m,v,s,f)}}var o,i=[],l=1<<(a=Math.max(0,a)),c=Math.max(.2,Math.min(1,.01*a)),s=e.precision(),u=e.precision(960).stream({point:function(){o=!1},lineStart:t,lineEnd:t,polygonStart:t,polygonEnd:t});return r(-180,-180,180,180),e.precision(s),i}}(),function(){function t(t){var n=-1,e=t.length,a=document.body.style;if(!("transformOrigin"in a))for(;++n<e;)if(t[n]+"TransformOrigin"in a)return"-"+t[n].toLowerCase()+"-";return""}function n(t){return t.key.join(", ")}function e(t){return(0|t)+"px"}function a(t){return 360*Math.atan(Math.exp(-t*Math.PI/180))/Math.PI-90}function r(t){return function(n,e,a){var r=Math.floor(n),o=Math.floor(e),i=Math.ceil(n),l=Math.ceil(e);return r===i||o===l?t(r,o,a):(t(r,o,a)*(i-n)*(l-e)+t(i,o,a)*(n-r)*(l-e)+t(r,l,a)*(i-n)*(e-o)+t(i,l,a)*(n-r)*(e-o))/((i-r)*(l-o))}}function o(t){return function(n){return t.replace(/\{([^\}]+)\}/g,function(t,e){var a=n[e];return null!=a?a:"quadkey"===e&&i(n.x,n.y,n.z)})}}function i(t,n,e){for(var a=[],r=1;e>=r;r++)a.push((1&n>>e-r)<<1|1&t>>e-r);return a.join("")}d3.geo.raster=function(){function t(t){var a=Math.max(f[0],Math.min(f[1],(0|Math.log(c.scale())/Math.LN2)-6)),r=a+6,o=c.scale()/(1<<r),s=c.translate(),p=t.selectAll("div").data([0]);p.enter().append("div").style(l+"transform-origin","0 0 0"),p.style(l+"transform","translate("+s.map(e)+")scale("+o+")");var g=p.selectAll(".tile").data(d3.quadTiles(c,a),n);g.enter().append("canvas").attr("class","tile").style("position","absolute").each(function(t){var n=this,e=t.image=new Image,a=t.key;e.crossOrigin=!0,e.onload=function(){setTimeout(function(){i(t,n,r)},1)},e.src=u({x:a[0],y:a[1],z:a[2],subdomain:d[(31*a[0]+a[1])%d.length]})}),g.exit().remove()}function i(t,n,e){var o=c.translate(),i=c.scale(),l=c.clipExtent(),u=t.image,f=u.width,d=u.height,h=t.key,m=1<<h[2];c.translate([0,0]).scale(1<<e).clipExtent(null),p.width=f,p.height=d,g.drawImage(u,0,0,f,d);var v=s.bounds(t),x=t.x0=0|v[0][0],y=t.y0=0|v[0][1],M=0|v[1][0]+1,b=0|v[1][1]+1,E=360*(h[0]/m)-180,I=360*((h[0]+1)/m)-180,w=360*(h[1]/m)-180,P=360*((h[1]+1)/m)-180;m\u03c60=a(w),m\u03c61=a(P);var m=n.width=M-x,z=n.height=b-y,k=n.getContext("2d");if(m>0&&z>0){for(var j=g.getImageData(0,0,f,d).data,N=k.createImageData(m,z),O=N.data,S=(r(function(t,n,e){return j[4*(n*f+t)+e]}),y),T=-1;b>S;++S)for(var q=x;M>q;++q){var A,C,D=c.invert([q,S]);if(!D||isNaN(A=D[0])||isNaN(C=D[1])||A>I||E>A||C>m\u03c60||m\u03c61>C)T+=4;else{C=a.invert(C);var L=4*((0|(A-E)/(I-E)*f)+(0|(C-w)/(P-w)*d)*f);O[++T]=j[L],O[++T]=j[++L],O[++T]=j[++L],O[++T]=255}}k.putImageData(N,0,0)}d3.selectAll([n]).style("left",x+"px").style("top",y+"px"),c.translate(o).scale(i).clipExtent(l)}var c,s=d3.geo.path(),u=null,f=[0,1/0],d=["a","b","c","d"],p=document.createElement("canvas"),g=p.getContext("2d");return t.projection=function(n){return arguments.length?(s.projection(c=n),t):c},t.url=function(n){return arguments.length?(u="string"==typeof n?o(n):n,t):u},t.scaleExtent=function(n){return arguments.length?(f=n,t):f},t.subdomains=function(n){return arguments.length?(d=n,t):d},t};var l=d3.geo.raster.prefix=t(["webkit","ms","moz","Moz","o","O"]);a.invert=function(t){return 180*-Math.log(Math.tan(.25*Math.PI+t*Math.PI/360))/Math.PI}}(),!function(){var t=window.devicePixelRatio||1,n=960*t,e=600*t,a=.5*t,r=d3.geo.albers().rotate([0,0]).center([0,52]).scale(150*t).translate([n/2,e/2]).clipExtent([[a,a],[n-a,e-a]]),o=d3.geo.raster().projection(r).scaleExtent([0,6]).url("//{subdomain}.tiles.mapbox.com/v3/mapbox.natural-earth-2/{z}/{x}/{y}.png"),i=d3.select("#map").style("width",n/t+"px").style("height",e/t+"px").call(d3.behavior.zoom().translate([.5*n/t,.5*e/t]).scale(r.scale()/t).scaleExtent([100,5e3]).on("zoom",function(){var n=d3.event.translate,e=d3.event.scale;r.translate([n[0]*t,n[1]*t]).scale(e*t),i.call(o)})).append("div").style(d3.geo.raster.prefix+"transform","scale("+1/t+")").style(d3.geo.raster.prefix+"transform-origin","0 0 0").append("div").style(d3.geo.raster.prefix+"transform-origin","0 0 0").call(o)}();
